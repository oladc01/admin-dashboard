<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Streetwear Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="flex h-screen">
    <aside class="w-64 bg-black text-white p-6 hidden md:block">
      <h2 class="text-2xl font-bold mb-6">Admin Panel</h2>
      <nav>
        <ul class="space-y-4">
          <li><a href="streetwear24-7.netlify.app" class="hover:text-yellow-400">Dashboard</a></li>
          <li><a href="#post" class="hover:text-yellow-400">Post Product</a></li>
          <li><a href="#manage" class="hover:text-yellow-400">Manage Products</a></li>
        </ul>
      </nav>
    </aside>
        
    <main class="flex-1 p-6 overflow-y-auto">
      <header class="mb-6">
        <h1 class="text-3xl font-bold">Streetwear Product Manager</h1>
      </header>

      
      <section id="post" class="bg-white p-6 rounded shadow mb-10">
        <h2 class="text-xl font-semibold mb-4">Post New Product</h2>
        <form id="productForm" class="space-y-4">
          <input id="title" type="text" placeholder="Product Title" class="w-full p-3 border rounded" required />
          <input id="desc" type="text" placeholder="Description" class="w-full p-3 border rounded" required />
          <input id="price" type="number" placeholder="Price (₦)" class="w-full p-3 border rounded" required />
          <input id="image" type="file" accept="image/*" class="w-full p-3 border rounded" required />
          <button type="submit" class="bg-black text-white px-6 py-2 rounded hover:bg-gray-800">Post Product</button>
        </form>
      </section>

     
      <section id="manage" class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">Manage Products</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full table-auto">
            <thead>
              <tr class="bg-gray-200 text-left">
                <th class="p-3">Image</th>
                <th class="p-3">Title</th>
                <th class="p-3">Price</th>
                <th class="p-3">Actions</th>
              </tr>
            </thead>
            <tbody id="productTable">
              <!-- Product rows inserted dynamically -->
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <script type="module">
    // Import Firebase modules
   import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";

    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL
    } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-storage.js";

    
  const firebaseConfig = {
  apiKey: "AIzaSyCGg7yqLwDAU3gBmfx3WQqVRWN5rp6TkFQ",
  authDomain: "streetwear24-7.firebaseapp.com",
  projectId: "streetwear24-7",
  storageBucket: "streetwear24-7.firebasestorage.app",
  messagingSenderId: "722353621637",
  appId: "1:722353621637:web:b8be5335cd89befd55b7ec"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const productsCol = collection(db, "products");

    const productForm = document.getElementById("productForm");
    const titleInput = document.getElementById("title");
    const descInput = document.getElementById("desc");
    const priceInput = document.getElementById("price");
    const imageInput = document.getElementById("image");
    const productTable = document.getElementById("productTable");

    productForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const file = imageInput.files[0];
      if (!file) return alert("Please select an image");

      try {
        // Upload image to Firebase Storage
        const imageRef = ref(storage, `productImages/${Date.now()}_${file.name}`);
        await uploadBytes(imageRef, file);
        const imageURL = await getDownloadURL(imageRef);

        await addDoc(productsCol, {
          title: titleInput.value,
          description: descInput.value,
          price: Number(priceInput.value),
          imageUrl: imageURL,
          createdAt: new Date()
        });

        productForm.reset();
        alert("Product posted!");
      } catch (err) {
        console.error("Error posting product:", err);
        alert("Failed to post product");
      }
    });

    function renderProducts() {
      onSnapshot(productsCol, (snapshot) => {
        productTable.innerHTML = "";
        snapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="p-3"><img src="${data.imageUrl}" class="w-12 h-12 object-cover" /></td>
            <td class="p-3">${data.title}</td>
            <td class="p-3">₦${data.price}</td>
            <td class="p-3 space-x-2">
              <button class="bg-blue-500 text-white px-3 py-1 rounded" onclick="editProduct('${docSnap.id}')">Edit</button>
              <button class="bg-red-500 text-white px-3 py-1 rounded" onclick="deleteProduct('${docSnap.id}')">Delete</button>
            </td>
          `;
          productTable.appendChild(row);
        });
      });
    }

    renderProducts();

    function deleteProduct(id) {
      if (confirm("Are you sure you want to delete this product?")) {
        deleteDoc(doc(db, "products", id))
          .then(() => console.log("Product deleted"))
          .catch((err) => console.error("Error deleting:", err));
      }
    }

    // Expose globally
    window.deleteProduct = deleteProduct;

    // Placeholder for editProduct (future enhancement)
    window.editProduct = (id) => alert(`Edit not implemented yet for ID: ${id}`);
  </script>
</body>
</html>
